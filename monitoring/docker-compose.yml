services:
  prometheus:
    image: prom/prometheus:v3.8.1
    container_name: prometheus
    command:
      - "--config.file=/etc/prometheus/prometheus.yml"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
    ports:
      - "9090:9090"
    environment:
      # отключаем прокси внутри контейнера
      - HTTP_PROXY=
      - HTTPS_PROXY=
      - FTP_PROXY=
      - http_proxy=
      - https_proxy=
      - ftp_proxy=

      # обязательно исключаем локальные адреса/сервисы
      - NO_PROXY=localhost,127.0.0.1,::1,host.containers.internal,prometheus,grafana
      - no_proxy=localhost,127.0.0.1,::1,host.containers.internal,prometheus,grafana

  grafana:
    image: grafana/grafana:main-ubuntu
    container_name: grafana
    ports:
      - "3000:3000"
    depends_on:
      - prometheus
    environment:
      - HTTP_PROXY=
      - HTTPS_PROXY=
      - FTP_PROXY=
      - http_proxy=
      - https_proxy=
      - ftp_proxy=

      - NO_PROXY=prometheus,localhost,127.0.0.1,::1
      - no_proxy=prometheus,localhost,127.0.0.1,::1


networks:
  monitoring:
    driver: bridge
